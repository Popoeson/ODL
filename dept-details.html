<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Department Details</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      background: #f4f6f9;
      color: #333;
    }

    header {
      background: #28a745;
      color: #fff;
      padding: 1rem;
      text-align: center;
    }

    main {
      max-width: 1000px;
      margin: 2rem auto;
      padding: 2rem;
      background: #fff;
      border-radius: 8px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }

    h2 {
      margin-top: 0;
      color: #0d47a1;
    }

    section {
      margin-bottom: 2rem;
    }

    .info p {
      margin: 6px 0;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 1rem;
    }

    table, th, td {
      border: 1px solid #ccc;
    }

    th, td {
      padding: 8px;
      text-align: left;
    }

    th {
      background: #f1f1f1;
    }

    .btn-enroll {
      display: block;
      text-align: center;
      background: #0d47a1;
      color: #fff;
      padding: 12px;
      border-radius: 6px;
      text-decoration: none;
      font-weight: bold;
      margin-top: 2rem;
    }

    .btn-enroll:hover {
      background: #1565c0;
    }
  </style>
</head>
<body>
  <header>
    <h1 id="deptName">Department</h1>
  </header>

  <main>
    <section class="info">
      <h2>Overview</h2>
      <p><strong>Faculty:</strong> <span id="faculty"></span></p>
      <p><strong>Head of Department:</strong> <span id="hod"></span></p>
      <p><strong>Duration:</strong> <span id="duration"></span></p>
      <p><strong>Contact:</strong> <span id="contact"></span></p>
      <p id="description"></p>
    </section>
<div class="contact-section">
  <h3>Contact Information</h3>
  <p><strong>Email:</strong> <span id="email"></span></p>
  <p><strong>Phone:</strong> <span id="phone"></span></p>
</div>
    <section>
      <h2>Admission Requirements</h2>
      <ul id="requirements"></ul>
    </section>

    <section>
      <h2>Courses</h2>
      <div id="courses"></div>
    </section>

    <section>
      <h2>Accreditation</h2>
      <p id="accreditation"></p>
    </section>

    <a href="enroll.html" class="btn-enroll">Enroll Now</a>
  </main>

  <script>
  const backendURL = "https://odl-450c.onrender.com/api/departments"; // replace with your real backend

  async function loadDepartmentDetails() {
    // âœ… Get deptId from query string instead of localStorage
    const params = new URLSearchParams(window.location.search);
    const deptId = params.get("id");

    if (!deptId) {
      document.querySelector("main").innerHTML = "<p>No department selected. Go back to the department list.</p>";
      return;
    }

    try {
      const res = await fetch(`${backendURL}/${deptId}`);
      const dept = await res.json();

      // Basic info
      document.getElementById("deptName").textContent = dept.department || "";
      document.getElementById("faculty").textContent = dept.faculty || "";
      document.getElementById("hod").textContent = dept.hod || "";
      document.getElementById("duration").textContent = dept.duration || "";
      document.getElementById("email").textContent = `${dept.email || ""}`;
      document.getElementById("phone").textContent = `${dept.phone || ""}`;
      document.getElementById("description").textContent = dept.description || "";

      // Requirements
const reqList = document.getElementById("requirements");
reqList.innerHTML = "";

if (dept.admissionRequirements && typeof dept.admissionRequirements === "object") {
  const req = dept.admissionRequirements;

  // O-level subjects
  if (Array.isArray(req.olevelSubjects) && req.olevelSubjects.length > 0) {
    const li = document.createElement("li");
    li.textContent = `O'Level Subjects: ${req.olevelSubjects.join(", ")}`;
    reqList.appendChild(li);
  }

  // JAMB Score
  if (req.jambScore) {
    const li = document.createElement("li");
    li.textContent = `Minimum JAMB Score: ${req.jambScore}`;
    reqList.appendChild(li);
  }

  // JAMB Combination
  if (Array.isArray(req.jambCombination) && req.jambCombination.length > 0) {
    const li = document.createElement("li");
    li.textContent = `JAMB Combination: ${req.jambCombination.join(", ")}`;
    reqList.appendChild(li);
  }

  // Extra O'Level
  if (req.extraOlevel) {
    const li = document.createElement("li");
    li.textContent = `Extra O'Level Requirement: ${req.extraOlevel}`;
    reqList.appendChild(li);
  }

} else {
  const li = document.createElement("li");
  li.textContent = "No requirements listed.";
  reqList.appendChild(li);
    }

      // Courses (group by year/semester)
      const coursesDiv = document.getElementById("courses");
      coursesDiv.innerHTML = "";
      if (dept.courses && dept.courses.length > 0) {
        dept.courses.forEach(group => {
          const h3 = document.createElement("h3");
          h3.textContent = `${group.year} - ${group.semester}`;
          coursesDiv.appendChild(h3);

          const table = document.createElement("table");
          const thead = document.createElement("thead");
          thead.innerHTML = "<tr><th>Course Code</th><th>Course Title</th><th>Units</th></tr>";
          table.appendChild(thead);

          const tbody = document.createElement("tbody");
          (group.courses || []).forEach(c => {
            const tr = document.createElement("tr");
            tr.innerHTML = `<td>${c.code}</td><td>${c.title}</td><td>${c.units}</td>`;
            tbody.appendChild(tr);
          });
          table.appendChild(tbody);

          coursesDiv.appendChild(table);
        });
      }

      // Accreditation
      document.getElementById("accreditation").textContent = dept.accreditation || "";
    } catch (err) {
      console.error(err);
      document.querySelector("main").innerHTML = "<p>Failed to load department details. Please try again later.</p>";
    }
  }

  document.addEventListener("DOMContentLoaded", loadDepartmentDetails);
  </script>
</body>
      </html>
